<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
        }

        .container {
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }

        #reader {
            width: 100%;
            max-width: 400px;
            height: auto;
            margin: 0 auto;
        }

        .buttons {
            margin-top: 20px;
        }

        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #accepted-list {
            margin-top: 20px;
            list-style-type: none;
            padding: 0;
        }

        #accepted-list li {
            display: flex;
            justify-content: space-between;
            background-color: #e0e0e0;
            margin: 5px 0;
            padding: 10px;
            border-radius: 5px;
        }

        #scan-result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        #quantity-input {
            margin-top: 10px;
            font-size: 16px;
            padding: 5px;
            width: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="scan-result"></div>
        <input type="number" id="quantity-input" placeholder="Qty" disabled />
        <div id="reader" style="display: none;"></div>
        <div class="buttons">
            <button id="new-btn">New</button>
            <button id="accept-btn" disabled>Accept</button>
            <button id="reject-btn" disabled>Reject</button>
        </div>
        <ul id="accepted-list"></ul>
    </div>

    <script>
        let currentScanData = null;
        let acceptedScans = [];
        let html5QrCode = null;

        // Initialize QR code scanner
        function initializeScanner() {
            html5QrCode = new Html5Qrcode("reader");
        }

        // Start QR code scanner
        function startScanner() {
            document.getElementById("reader").style.display = "block"; // Show the camera
            document.getElementById("scan-result").textContent = ""; // Clear previous scan result
            document.getElementById("quantity-input").value = ""; // Clear quantity input
            currentScanData = null;

            const qrCodeSuccessCallback = (qrCodeMessage) => {
                currentScanData = qrCodeMessage; // Store scanned text
                stopScanner(); // Stop scanning after successful scan
                document.getElementById("scan-result").textContent = "Scanned: " + currentScanData; // Show the result
                document.getElementById("quantity-input").disabled = false; // Enable quantity input
                document.getElementById("accept-btn").disabled = false; // Enable "Accept" button
                document.getElementById("reject-btn").disabled = false; // Enable "Reject" button
            };

            const config = { facingMode: "environment" };
            const qrCodeConfig = { fps: 10 };

            html5QrCode.start(config, qrCodeConfig, qrCodeSuccessCallback).catch(err => {
                console.error("Unable to start the QR code scanner:", err);
            });
        }

        // Stop QR code scanner
        function stopScanner() {
            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    document.getElementById("reader").style.display = "none"; // Hide the camera
                }).catch(err => {
                    console.error("Unable to stop the QR code scanner:", err);
                });
            }
        }

        // Update the list of accepted scans
        function updateAcceptedList() {
            const list = document.getElementById("accepted-list");
            list.innerHTML = ""; // Clear current list
            acceptedScans.forEach(scan => {
                const listItem = document.createElement("li");
                listItem.innerHTML = `<span>${scan.text}</span> <span>Qty: ${scan.quantity}</span>`;
                list.prepend(listItem); // Add newest at the top
            });
        }

        // Accept button event listener
        document.getElementById("accept-btn").addEventListener("click", () => {
            const quantity = document.getElementById("quantity-input").value;
            if (currentScanData && quantity) {
                acceptedScans.unshift({ text: currentScanData, quantity: quantity }); // Add new scan at the top
                updateAcceptedList();
                currentScanData = null;
                document.getElementById("scan-result").textContent = ""; // Clear scan result
                document.getElementById("quantity-input").value = ""; // Clear quantity input
                document.getElementById("quantity-input").disabled = true; // Disable quantity input
                document.getElementById("accept-btn").disabled = true; // Disable "Accept" button
                document.getElementById("reject-btn").disabled = true; // Disable "Reject" button
            } else {
                alert("Please scan a QR code and enter a valid quantity!");
            }
        });

        // Reject button event listener
        document.getElementById("reject-btn").addEventListener("click", () => {
            currentScanData = null;
            document.getElementById("scan-result").textContent = ""; // Clear scan result
            document.getElementById("quantity-input").value = ""; // Clear quantity input
            document.getElementById("quantity-input").disabled = true; // Disable quantity input
            document.getElementById("accept-btn").disabled = true; // Disable "Accept" button
            document.getElementById("reject-btn").disabled = true; // Disable "Reject" button
        });

        // New button event listener
        document.getElementById("new-btn").addEventListener("click", () => {
            if (!html5QrCode) {
                initializeScanner(); // Initialize the scanner if not already done
            }
            document.getElementById("quantity-input").disabled = true; // Disable quantity input until scan
            document.getElementById("accept-btn").disabled = true; // Disable "Accept" button
            document.getElementById("reject-btn").disabled = true; // Disable "Reject" button
            startScanner(); // Start scanning
        });

        // Initialize the QR code scanner on page load
        window.onload = () => {
            initializeScanner();
        };
    </script>
</body>
</html>
