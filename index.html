<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Reader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #camera {
            width: 300px;
            height: 200px;
            border: 1px solid #ccc;
            margin-top: 20px;
        }
        #buttons {
            margin-top: 20px;
        }
        #accepted-reads {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            width: 300px;
            background: #fff;
        }
        .accepted-item {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div id="camera"></div>
    <div id="buttons">
        <button id="accept">Accept</button>
        <button id="reject">Reject</button>
        <button id="new">New Scan</button>
    </div>
    <div id="accepted-reads"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cameraElement = document.getElementById('camera');
            const acceptButton = document.getElementById('accept');
            const rejectButton = document.getElementById('reject');
            const newButton = document.getElementById('new');
            const acceptedReadsDiv = document.getElementById('accepted-reads');
            
            let currentScanResult = null;
            let html5QrCode = null;

            function startCamera() {
                if (html5QrCode) {
                    html5QrCode.stop().then(() => {
                        html5QrCode = new Html5Qrcode("camera");
                        html5QrCode.start(
                            { facingMode: "environment" },
                            {
                                fps: 10,
                                qrbox: 250
                            },
                            (decodedText, decodedResult) => {
                                currentScanResult = decodedText;
                                stopCamera();
                            },
                            (errorMessage) => {
                                console.error(errorMessage);
                            }
                        );
                    }).catch(err => console.error('Error stopping camera:', err));
                } else {
                    html5QrCode = new Html5Qrcode("camera");
                    html5QrCode.start(
                        { facingMode: "environment" },
                        {
                            fps: 10,
                            qrbox: 250
                        },
                        (decodedText, decodedResult) => {
                            currentScanResult = decodedText;
                            stopCamera();
                        },
                        (errorMessage) => {
                            console.error(errorMessage);
                        }
                    );
                }
            }

            function stopCamera() {
                if (html5QrCode) {
                    html5QrCode.stop().then(() => {
                        cameraElement.innerHTML = "";
                        html5QrCode = null;
                    }).catch(err => console.error('Error stopping camera:', err));
                }
            }

            function addAcceptedRead(content) {
                const item = document.createElement('div');
                item.className = 'accepted-item';
                item.textContent = content;
                acceptedReadsDiv.appendChild(item);
            }

            acceptButton.addEventListener('click', () => {
                if (currentScanResult) {
                    addAcceptedRead(currentScanResult);
                    currentScanResult = null;
                }
            });

            rejectButton.addEventListener('click', () => {
                currentScanResult = null;
            });

            newButton.addEventListener('click', () => {
                startCamera();
            });
        });
    </script>
</body>
</html>
